# COMPAS for Building Information Modelling

> **WARNING:** COMPAS IFC is currently being upgraded to support COMPAS 2.0.
> This upgrade is scheduled to be completed by the end of January 2024.
> This tutorial is the intended usage for COMPAS IFC with COMPAS 2.0.
> If you wish to use COMPAS IFC at its current state, please refer to the [COMPAS IFC documentation](https://compas.dev/compas_ifc).

Creating custom computational workflows for BIM can be challenging, because most commercial BIM applications are close-sourced and not designed to be extended. It is also not easy to perform data-exchange between BIM applications like Revit and CAD software such as Rhino or Analysis tools such as FEA softwares. COMPAS provides a set of tools for working with BIM data in a transparent and interoperable way through IFC format, allowing users to programatically extract information, perform analysis on, modify or create BIM models in multiple plaforms.

This tutorial will give an example of using COMPAS to load a BIM model of a simple house, replace its wall with a parametric one with custom metadata and then export again as a valid IFC file.

(IMAGE PREVIEW OF THE FINAL MODEL)

## Setup

Create a new environment with BIM related packages in COMPAS ecosystem. Where `bim` is the name of the environment. `compas_ifc` is a package for reading and writing IFC files, a widely used digital format for BIM applications. `compas_viewer` is a package for creating custom viewers.
```bash
conda create -n bim compas_ifc compas_occ compas_viewer
```

Alternatively, you can create the environment from the provided `environment.yml` file.
```bash
conda env create -f environment.yml
```

Activate the environment and start the Python interpreter.
```bash
python -m compas_rhino.install -v 8.0
```

Activate the environment and start the Python interpreter.
```bash
conda activate bim
python
```

Check the version installed packages.
```bash
>>> import compas_ifc
>>> compas_ifc.__version__
'1.0.0'
>>> import compas_viewer
>>> compas_ifc.__version__
'2.0.1'
```

## Open IFC file of existing BIM model with stand-alone viewer
The `compas_ifc` package provides a stand-alone viewer. It can be used conveniently to inspect IFC file contents.

```bash
>>> from compas_ifc import IFCModel
>>> model = IFCModel.from_file('data/wall-with-opening-and-window.ifc')
>>> model.summary()
===============================================================================
IFCModel summary
-------------------------------------------------------------------------------
Filename: data/wall-with-opening-and-window.ifc
File size: 0.5 MB
Entity count: 123
Project: "Wall with opening and window"
Buildings: 1
...
===============================================================================
```
Print the spatial hierrachy of the model.
```
>>> model.print_hierarchy()
└── Default Project [IfcProject]
    └── Default Site [IfcSite]
        └── Default Building [IfcBuilding]
            └── Default Building Storey [IfcBuildingStorey]
                ├── Wall [IfcWall]
                │   └── Wall Openning [IfcOpeningElement]
                └── Window [IfcWindow]
```
Visualize the model in a viewer.
```
>>> model.show()
```
(IMAGE FOR VIEWER SHOWING THE INITIAL MODEL)

## Manipulate the BIM model with COMPAS in Rhino
Through `compas_rhino`, the BIM model can also be loaded into Rhino, where it can be integrated with new components come directly from COMPAS or native Rhino geometries.

Firstly, let's load the model and visualise it in Rhino by runnning this script:
```python
from compas.scene import Scene
from compas_ifc import IFCModel
scene = Scene()
model = IFCModel.from_file('data/wall-with-opening-and-window.ifc')
scene.add(model)
scene.redraw()
```

(IMAGE SHOWING THE IFC MODEL IN RHINO)

Now with the model loaded into Rhino, we can use this [Grasshopper script]() to generate a parametric wall.

But before that we need preprocess the existing IFC wall geometry a bit, to make it suitable as the Grasshoper script input.
```
some script to simplify the wall geometry.
```

(IMAGE OF SIMPLIFIED WALL GEOMETRY AS INPUT TO GRASSHOPPER SCRIPT)

Now it's time to run the Grasshopper script to generate the parametric wall. We select the simplified wall geometry as the input to the Grasshopper script and bake the output.

(IMAGE PARAMETRIC WALL GENERATED BY GRASSHOPPER SCRIPT)

## Integrate custom geometry into the IFC model, with custom attributes
The next step is to integrate the parametric wall into the IFC model. We can do this by using the `compas_ifc` package to read the parametric wall geometry from Rhino and then replace the existing wall geometry in the IFC model with the new one.

```
script to read the parametric wall geometry from Rhino and insert it into the IFC model.
```

Additionally, we can also add custom attributes to the parametric wall, such as the wall thickness, material, etc. 
```
script adding attributes and properties to the parametric wall.
```


## Export the IFC model to a new IFC file
The final step is to export the modified IFC model to a new IFC file.
```
script to export the IFC model to a new IFC file.
```

We can then open the new IFC file in the stand-alone viewer to examine the result.
```
script to open the new IFC file in the stand-alone viewer.
```

## Full automation
The whole process can be condensed into a single script, which can be run directly from the command line without any CAD software...